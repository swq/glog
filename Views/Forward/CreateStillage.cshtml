
@{
    ViewBag.Title = "CreateStillage";
}
<link href="@Url.Content("~/Content/bootstrap.min.css")" rel="stylesheet" />
<link href="@Url.Content("~/Content/AdminLTE.css")" rel="stylesheet" />
<link href="@Url.Content("~/Content/Skin/skin-blue.css")" rel="stylesheet" />
<link href="@Url.Content("~/Content/font-awesome/font-awesome.min.css")" rel="stylesheet" />
<link href="@Url.Content("~/Content/SpreadJS_CSS/gc.spread.sheets.excel2016colorful.10.0.1.css")" rel="stylesheet" />
<link href="@Url.Content("~/Content/Tree/metroStyle.css")" rel="stylesheet" />
<link href="~/Content/Datepicker/datepicker3.css" rel="stylesheet" />
<div class="row">
    <div class="col-md-12">
        <div class="box box-primary direct-chat direct-chat-primary">
            <div class="box-header">
                <table>
                    <tr style="height:36px">
                        <td width="70px" style="padding-left:10px"><span style="font-size:14px">小箱号:</span></td>
                        <td width="150px" style="padding-left:10px"><input class="form-control input-sm" type="text" placeholder="小箱号"></td>
                        <td width="100px" style="padding-left:10px"><span style="font-size:14px">计划装箱日期:</span></td>
                        <td width="170px" style="padding-left:10px">
                            <div class="input-group date">
                                <div class="input-group-addon">
                                    <i class="fa fa-calendar"></i>
                                </div>
                                <input class="form-control pull-right" id="planedate" type="text">
                            </div>
                        </td>
                        <td width="50px" style="padding-left:10px"><span style="font-size:14px">状态:</span></td>
                        <td width="120px" style="padding-left:10px"><input class="form-control input-sm" type="text" placeholder="状态:"></td>
                        <td width="21%" style="padding-left:10px"><span style="font-size:14px">说明:</span></td>
                    </tr>
                    <tr style="height:36px">
                        <td width="70px" style="padding-left:10px"><span style="font-size:14px">供货方:</span></td>
                        <td width="150px" style="padding-left:10px"><input class="form-control input-sm" type="text" placeholder="供货方"></td>
                        <td width="100px" style="padding-left:10px"><span style="font-size:14px">实际装箱日期:</span></td>
                        <td width="170px" style="padding-left:10px">
                            <div class="input-group date">
                                <div class="input-group-addon">
                                    <i class="fa fa-calendar"></i>
                                </div>
                                <input class="form-control pull-right" id="actualdate" type="text">
                            </div>
                        </td>
                        <td width="50px" style="padding-left:10px"><span style="font-size:14px">宽:</span></td>
                        <td width="120px" style="padding-left:10px"><input class="form-control input-sm" type="text" placeholder="宽"></td>
                        <td rowspan="3" align="center" >
                            <div style="margin-left:10px"><textarea class="form-control" rows="3" placeholder="Enter ..."></textarea>
                            </div>
                        </td>
                    </tr>
                    <tr style="height:36px">
                        <td width="70px" style="padding-left:10px"><span style="font-size:14px">收货方:</span></td>
                        <td width="150px" style="padding-left:10px"><input class="form-control input-sm" type="text" placeholder="收货方"></td>
                        <td width="100px" style="padding-left:10px"><span style="font-size:14px">状态:</span></td>
                        <td width="150px" style="padding-left:10px"><input class="form-control input-sm" type="text" placeholder="状态:"></td>
                        <td width="50px" style="padding-left:10px"><span style="font-size:14px">长:</span></td>
                        <td width="120px" style="padding-left:10px"><input class="form-control input-sm" type="text" placeholder="长"></td>
                        <td></td>
                    </tr>
                    <tr style="height:36px">
                        <td width="70px" style="padding-left:10px"><span style="font-size:14px">集装箱号:</span></td>
                        <td width="150px" style="padding-left:10px"><input class="form-control input-sm" type="text" placeholder="集装箱号"></td>
                        <td width="100px" style="padding-left:10px"><span style="font-size:14px">重量:</span></td>
                        <td width="150px" style="padding-left:10px"><input class="form-control input-sm" type="text" placeholder="重量"></td>
                        <td width="50px" style="padding-left:10px"><span style="font-size:14px">高:</span></td>
                        <td width="120px" style="padding-left:10px"><input class="form-control input-sm" type="text" placeholder="高"></td>
                        <td></td>
                    </tr>
                </table>
                <div class="btn-group" style='width: 100%; margin-left:1px;'>
                    <button class="btn btn-app" type="button" id="btn_add">
                        <span class="fa fa-plus"></span>添加
                    </button>
                    <button class="btn btn-app" type="button" id="btn_Save">
                        <span class="fa fa-save"></span>保存
                    </button>
                    <button class="btn btn-app" type="button" id="btn_Delete">
                        <span class="fa fa-times"></span>删除
                    </button>
                    <button class="btn btn-app" type="button" id="btn_Count">
                        <span class="fa fa-building"></span>计算
                    </button>
                    <button class="btn btn-app" type="button" id="Clear">
                        <span class="fa fa-tag"></span>完成
                    </button>
                </div>
            <div id='MianSpread' style='width: 100%; height: 600px;'></div>
        </div>
    </div>
    </div>
</div>

<script src="~/Scripts/jQuery-2.2.0.min.js"></script>
<script src="~/Scripts/bootstrap.min.js"></script>
<script src="~/Scripts/dist/app.min.js"></script>
<script src="~/Scripts/SpreadJS/gc.spread.sheets.all.10.0.1.min.js"></script>
<script src="~/Scripts/SpreadJS/gc.spread.excelio.10.0.1.min.js"></script>
<script src="~/Scripts/SpreadJS/gc.spread.sheets.resources.zh.10.0.1.min.js"></script>
<script src="~/Scripts/Datepicker/bootstrap-datepicker.js"></script>
<script src="~/Scripts/Datepicker/bootstrap-datepicker.zh-CN.js"></script>
<script type="text/javascript">
    var spreadNS = GC.Spread.Sheets;
    var spread;
    var sheet;
    var colInfos = [
        { name: 'GUID', size: 32, visible: false },
        { name: 'TA_ID', size: 20, visible: false },
        { name: 'Pro_ID', size: 20, visible: false },
        { name: 'BT_Code', displayName: 'BT编号', size: 80, visible: true, formatter: Text },
        { name: 'Description_EN', displayName: 'BT英文描述', size: 140, formatter: Text },
        { name: 'Description_CN', displayName: 'BT中文描述', size: 140, formatter: Text },
        { name: 'Units', displayName: '单位', size: 60, resizable: false, formatter: Text },
        { name: 'Qty', displayName: '数量', size: 60, resizable: false, formatter: Number },
        { name: 'Drawing', displayName: '图号', size: 100, resizable: true, formatter: Text },
        { name: 'Comments', displayName: '备注', size: 150, resizable: true, formatter: Text },
        { name: 'Dimension', displayName: '规格尺寸', size: 100, resizable: true, formatter: Text },
        { name: 'Specification', displayName: '材质、型号', size: 100, resizable: true, formatter: Text }
    ];
    $(
        function () {
            SpreadInit();
            $("#planedate").datepicker({
                language: "zh-CN",
                autoclose: true,//选中之后自动隐藏日期选择框
                clearBtn: true,//清除按钮
                todayBtn: true,//今日按钮
                format: "yyyy-mm-dd"//日期格式
            });
            $("#actualdate").datepicker({
                language: "zh-CN",
                autoclose: true,//选中之后自动隐藏日期选择框
                clearBtn: true,//清除按钮
                todayBtn: true,//今日按钮
                format: "yyyy-mm-dd"//日期格式
            });
        }
    );
    //添加行(10)
    $('#btn_add').click(function () {
        var row = sheet.getRowCount();
        sheet.suspendPaint();
        sheet.addRows(row, 1);
        //sheet.setValue(row, 1, 1112);
        //sheet.setValue(row, 2, 1);
        //sheet.setValue(row, 7, 0);
        //获取行数
        var count = sheet.getRowCount(GC.Spread.Sheets.SheetArea.viewport);
        //设置筛选
        var filter = new spreadNS.Filter.HideRowFilter(new spreadNS.Range(0, 0, count, 9));
        sheet.rowFilter(filter);
        sheet.resumePaint();
    });
    //删除行
    $('#btn_Delete').click(function () {
        sheet.suspendPaint();
        sheet.deleteRows(sheet.getActiveRowIndex(), 1); //行与列&选择单元格
        sheet.resumePaint();
    });
    //保存
    $('#btn_Save').click(function () {
        var JsonData = [{}];
        for (var i = 0 ; i < sheet.getRowCount; i++)
        {
            var BTID = sheet.getValue(i, 0, sheetArea);
            var Amount = sheet.getValue(i, 4, sheetArea);
            JsonData.add({ 'BTID': BTID, 'Amount': Amount});
        }
        $.post("/Forward/CreateStillageSave", { 'JsonData': JsonData },
            function (Mess) {

            });
    });
    //计算
    $('#btn_Count').click(function () {
        var data1 = [];
        var data2 = [];
        var ProID = 1;
        for (var i = 0 ; i < sheet.getRowCount; i++)
        {
            data1.push(sheet.getValue(i, 0, sheetArea));
        }
        for (var i = 0 ; i < sheet.getRowCount; i++)
        {
            data2.push(sheet.getValue(i, 7, sheetArea));
        }

        $.post("/Forward/GetDataStillage", { 'data1': JSON.stringify(data1), 'data2': JSON.stringify(data2), 'ProID': ProID },
            function (rel) {
                for (var i = 0 ; i < sheet.getRowCount; i++)
                {
                    var BT = sheet.getValue(i, 0, sheetArea);
                    var Qty = sheet.getValue(i, 6, sheetArea);
                    var TA = sheet.getValue(i, 7, sheetArea);
                    for (var j = 0 ; j < rel.Date.count;j++)
                    {
                        if (BT == rel.Date[j].BT_Code && TA == rel.Date[j].TA_ID)
                        {
                            sheet.setValue(i, 1, rel.Date[j].Description_EN);
                            sheet.setValue(i, 2, rel.Date[j].Description_CN);
                            sheet.setValue(i, 3, rel.Date[j].Units);
                            sheet.setValue(i, 5, rel.Date[j].Qty);
                            sheet.setValue(i, 6, rel.Date[j].Qty - Qty);

                        }
                    }
                }
                alert('保存成功！');
            });
    });

    function SpreadInit()
    {
        spread = new GC.Spread.Sheets.Workbook(document.getElementById('MianSpread'), { sheetCount: 1 });
        sheet = spread.getSheet(0);
        sheet.setColumnCount(9, GC.Spread.Sheets.SheetArea.viewport);
        //列宽
        sheet.setColumnWidth(0, 80);
        sheet.setColumnWidth(1, 140);
        sheet.setColumnWidth(2, 140);
        sheet.setColumnWidth(3, 60);
        sheet.setColumnWidth(4, 90);
        sheet.setColumnWidth(5, 90);
        sheet.setColumnWidth(6, 90);
        sheet.setColumnWidth(7, 90);
        sheet.setColumnWidth(8, 100);
        //列头文本
        sheet.setValue(0, 0, "BT编号", GC.Spread.Sheets.SheetArea.colHeader);
        sheet.setValue(0, 1, "英文描述", GC.Spread.Sheets.SheetArea.colHeader);
        sheet.setValue(0, 2, "中文描述", GC.Spread.Sheets.SheetArea.colHeader);
        sheet.setValue(0, 3, "单位", GC.Spread.Sheets.SheetArea.colHeader);
        sheet.setValue(0, 4, "包装数量", GC.Spread.Sheets.SheetArea.colHeader);
        sheet.setValue(0, 5, "总量", GC.Spread.Sheets.SheetArea.colHeader);
        sheet.setValue(0, 6, "剩余量", GC.Spread.Sheets.SheetArea.colHeader);
        sheet.setValue(0, 7, "TA编码", GC.Spread.Sheets.SheetArea.colHeader);
        sheet.setValue(0, 8, "单号", GC.Spread.Sheets.SheetArea.colHeader);
        //获取行数
        var count = sheet.getRowCount(GC.Spread.Sheets.SheetArea.viewport);
        //设置筛选
        var filter = new spreadNS.Filter.HideRowFilter(new spreadNS.Range(0, 0, count, 11));
        sheet.setRowCount(0, GC.Spread.Sheets.SheetArea.viewport);
        sheet.rowFilter(filter);
    }

</script>